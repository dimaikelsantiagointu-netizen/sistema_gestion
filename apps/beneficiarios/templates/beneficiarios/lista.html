{% extends 'base.html' %}

{% block content %}
<div class="max-w-[1600px] mx-auto animate-fade-in pb-10 px-4 sm:px-6">
    
    {# --- ENCABEZADO --- #}
    <div class="mb-10 flex flex-col lg:flex-row lg:items-center justify-between gap-6">
        <div>
            <div class="flex items-center gap-2 mb-1">
                <span class="w-2 h-2 rounded-full bg-intu-red animate-pulse"></span>
                <span class="text-[10px] font-black text-gray-400 uppercase tracking-[0.3em]">SIG-INTU v2.0</span>
            </div>
            <h1 class="text-3xl font-black text-intu-blue uppercase tracking-tighter">Beneficiarios</h1>
        </div>
        
        <div class="flex flex-wrap gap-3">
            <a href="{% url 'beneficiarios:exportar_excel' %}" class="px-5 py-3 text-[10px] font-black bg-emerald-600 text-white rounded-2xl hover:bg-emerald-700 transition-all active:scale-95 uppercase tracking-wider flex items-center shadow-lg shadow-emerald-200">
                <i class="fas fa-file-excel mr-2 text-sm"></i> Reporte
            </a>
            <a href="{% url 'beneficiarios:registrar_visita' %}" class="px-5 py-3 text-[10px] font-black bg-intu-blue text-white rounded-2xl hover:bg-blue-800 transition-all active:scale-95 uppercase tracking-wider flex items-center shadow-lg shadow-blue-200">
                <i class="fas fa-walking mr-2 text-sm"></i> Registrar Visita
            </a>
            <a href="{% url 'beneficiarios:crear' %}" class="px-5 py-3 text-[10px] font-black bg-intu-red text-white rounded-2xl shadow-lg shadow-red-200 hover:bg-red-700 transition-all active:scale-95 uppercase tracking-wider flex items-center">
                <i class="fas fa-user-plus mr-2 text-sm"></i> Nuevo Registro
            </a>
        </div>
    </div>

    {# --- ESTADÍSTICAS --- #}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
        <div class="bg-white p-6 rounded-[2rem] border border-blue-100 shadow-sm flex items-center justify-between">
            <div>
                <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1">Población</p>
                <p class="text-3xl font-black text-intu-blue">{{ total_beneficiarios }}</p>
            </div>
            <div class="w-14 h-14 bg-blue-600 text-white rounded-2xl flex items-center justify-center text-2xl">
                <i class="fas fa-users"></i>
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-[2rem] border border-amber-100 shadow-sm flex items-center justify-between">
            <div>
                <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1">Visitas Hoy</p>
                <p class="text-3xl font-black text-amber-500">{{ visitas_hoy_count|default:"0" }}</p>
            </div>
            <div class="w-14 h-14 bg-amber-500 text-white rounded-2xl flex items-center justify-center text-2xl shadow-lg shadow-amber-100">
                <i class="fas fa-calendar-check"></i>
            </div>
        </div>

        <div class="bg-white p-6 rounded-[2rem] border border-emerald-100 shadow-sm flex items-center justify-between">
            <div>
                <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1">Digitalizados</p>
                <p class="text-3xl font-black text-emerald-500">{{ beneficiarios_con_docs|default:"0" }}</p>
            </div>
            <div class="w-14 h-14 bg-emerald-500 text-white rounded-2xl flex items-center justify-center text-2xl shadow-lg shadow-emerald-100">
                <i class="fas fa-file-shield"></i>
            </div>
        </div>
    </div>

    {# --- BARRA DE BÚSQUEDA (AHORA DEBAJO DE LAS CARDS) --- #}
    <div class="mb-8">
        <form method="GET" action="{% url 'beneficiarios:lista' %}" class="relative max-w-2xl">
            <input type="text" name="q" value="{{ query|default:'' }}" 
                   placeholder="Buscar por nombre o número de cédula..." 
                   class="w-full pl-14 pr-6 py-4 bg-white border-2 border-slate-100 rounded-[1.5rem] text-sm font-bold text-slate-700 placeholder:text-slate-300 focus:border-intu-blue focus:ring-4 focus:ring-blue-50 transition-all shadow-sm">
            <div class="absolute left-5 top-1/2 -translate-y-1/2 text-slate-300 text-lg">
                <i class="fas fa-magnifying-glass"></i>
            </div>
            {% if query %}
                <a href="{% url 'beneficiarios:lista' %}" class="absolute right-4 top-1/2 -translate-y-1/2 text-[10px] font-black text-intu-red uppercase bg-red-50 px-3 py-1.5 rounded-lg hover:bg-red-100 transition-colors">
                    Limpiar
                </a>
            {% endif %}
        </form>
    </div>

    {# --- TABLA COMPLETA --- #}
    <div class="bg-white rounded-[2.5rem] shadow-2xl shadow-gray-200/50 border border-gray-100 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-slate-900 border-b border-slate-800">
                        <th class="px-6 py-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Beneficiario / ID</th>
                        <th class="px-6 py-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Contacto / Correo</th>
                        <th class="px-6 py-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">Ubicación</th>
                        <th class="px-6 py-6 text-[10px] font-black text-slate-400 uppercase tracking-widest text-center">Docs</th>
                        <th class="px-6 py-6 text-[10px] font-black text-slate-400 uppercase tracking-widest text-center">Historial</th>
                        <th class="px-6 py-6 text-[10px] font-black text-slate-400 uppercase tracking-widest text-right">Gestión</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-50">
                    {% for b in beneficiarios %}
                    <tr class="hover:bg-slate-50 transition-all duration-200 group">
                        {# (El contenido de la fila se mantiene igual...) #}
                        <td class="px-6 py-5">
                            <div class="flex items-center">
                                <span class="w-9 h-9 flex items-center justify-center bg-intu-blue text-white text-[11px] font-black rounded-xl mr-3 shadow-md group-hover:scale-110 transition-transform">
                                    {{ b.tipo_documento|slice:":1" }}
                                </span>
                                <div>
                                    <div class="text-[13px] font-black text-slate-900 uppercase tracking-tight group-hover:text-intu-blue transition-colors">{{ b.nombre_completo }}</div>
                                    <div class="text-[10px] font-bold text-slate-400">{{ b.documento_identidad }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-5">
                            <div class="text-[12px] font-bold text-slate-700 uppercase"><i class="fas fa-phone text-emerald-500 mr-1"></i> {{ b.telefono|default:"---" }}</div>
                            <div class="text-[10px] font-medium text-blue-500 lowercase mt-1 italic"><i class="fas fa-envelope text-blue-300 mr-1"></i> {{ b.email|default:"sin correo" }}</div>
                        </td>
                        <td class="px-6 py-5">
                            <div class="max-w-[200px] text-[10px] text-slate-500 font-semibold leading-tight">
                                <i class="fas fa-map-marker-alt text-intu-red/50 mr-1"></i> {{ b.direccion|default:"No registrada"|truncatechars:60 }}
                            </div>
                        </td>
                        <td class="px-6 py-5 text-center">
                            <a href="{% url 'beneficiarios:expediente' b.id %}" class="inline-flex items-center px-4 py-2.5 rounded-2xl bg-blue-50 text-blue-700 hover:bg-blue-600 hover:text-white text-[10px] font-black uppercase transition-all shadow-sm border border-blue-100">
                                <i class="fas fa-folder-open mr-2 text-sm"></i> {{ b.documentos.count }}
                            </a>
                        </td>
                        <td class="px-6 py-5 text-center">
                            <a href="{% url 'beneficiarios:detalle' b.id %}" class="inline-flex items-center px-4 py-2.5 rounded-2xl bg-indigo-50 text-indigo-700 hover:bg-indigo-600 hover:text-white text-[10px] font-black uppercase transition-all shadow-sm border border-indigo-100">
                                <i class="fas fa-clock-rotate-left mr-2 text-sm"></i> {{ b.visitas.count }}
                            </a>
                        </td>
                        <td class="px-6 py-5 text-right">
                            <div class="flex justify-end gap-2">
                                <a href="{% url 'beneficiarios:editar' b.id %}" class="w-9 h-9 flex items-center justify-center rounded-xl bg-slate-100 text-slate-500 hover:bg-amber-500 hover:text-white transition-all"><i class="fas fa-user-pen text-xs"></i></a>
                                <a href="{% url 'beneficiarios:eliminar' b.id %}" onclick="return confirm('¿Seguro que desea eliminar?')" class="w-9 h-9 flex items-center justify-center rounded-xl bg-slate-100 text-slate-500 hover:bg-red-600 hover:text-white transition-all"><i class="fas fa-trash-can text-xs"></i></a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="py-24 text-center">
                            <h3 class="text-sm font-black text-gray-300 uppercase tracking-widest">Sin resultados</h3>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {# --- PAGINACIÓN (NUEVO) --- #}
        {% if beneficiarios.has_other_pages %}
        <div class="px-6 py-6 bg-slate-50 border-t border-gray-100 flex items-center justify-between">
            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">
                Página {{ beneficiarios.number }} de {{ beneficiarios.paginator.num_pages }}
            </span>
            <div class="flex gap-2">
                {% if beneficiarios.has_previous %}
                    <a href="?page={{ beneficiarios.previous_page_number }}{% if query %}&q={{ query }}{% endif %}" 
                       class="px-4 py-2 bg-white border border-slate-200 text-[10px] font-black text-slate-600 rounded-xl hover:bg-intu-blue hover:text-white transition-all uppercase">
                        Anterior
                    </a>
                {% endif %}

                {% if beneficiarios.has_next %}
                    <a href="?page={{ beneficiarios.next_page_number }}{% if query %}&q={{ query }}{% endif %}" 
                       class="px-4 py-2 bg-white border border-slate-200 text-[10px] font-black text-slate-600 rounded-xl hover:bg-intu-blue hover:text-white transition-all uppercase">
                        Siguiente
                    </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}